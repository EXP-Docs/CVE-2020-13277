# How to use :
# docker-compose up -d
# docker-compose down
# --------------------------------------------------------------------------------

version: '2'
services:
  ruby:
    hostname: LICENSE
    container_name: docker_license
    build:
      context: ./license
      dockerfile: ./Dockerfile
    volumes:
      - ./script:/opt
    networks: 
      vpn:
        ipv4_address: 172.168.30.2
    restart: unless-stopped


  gitlab:
    hostname: GITLAB
    container_name: docker_gitlab
    image: gitlab/gitlab-ee:12.10.0-ee.0
    volumes:
      - ./gitlab/config:/etc/gitlab
      - ./gitlab/data:/var/opt/gitlab
      - ./gitlab/logs:/var/log/gitlab
      - ./license/script/license_key.pub:/opt/gitlab/embedded/service/gitlab-rails/.license_encryption_key.pub
    ports:
      - 8443:443
      - 8080:80
#     - 2222:22
    networks: 
      vpn:
        ipv4_address: 172.168.30.3
    depends_on: 
      - ruby
    restart: unless-stopped


networks:
  vpn:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet:  172.168.30.0/24
          gateway: 172.168.30.1

