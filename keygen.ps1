# 生成 Gitlab License

$IMAGE_NAME = "gitlab_license_i"
$CONTAINER_NAME = "gitlab_license_c"

docker build ./license -t ${IMAGE_NAME}
Sleep 2

$IMAGE_ID = (docker image ls -aq --filter reference=${IMAGE_NAME})
docker run --name=${CONTAINER_NAME} ${IMAGE_ID} bash
Sleep 2

$DOCKER_ID = (docker ps -aq --filter name=${CONTAINER_NAME})
if(![String]::IsNullOrEmpty(${DOCKER_ID})) {
    docker cp ${DOCKER_ID}:/opt/license_key ./gitlab/keys/license_key
    docker cp ${DOCKER_ID}:/opt/license_key.pub ./gitlab/keys/license_key.pub
    docker cp ${DOCKER_ID}:/opt/GitLabBV.gitlab-license ./gitlab/keys/GitLabBV.gitlab-license
}
